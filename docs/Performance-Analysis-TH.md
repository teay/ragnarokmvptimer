# สรุปการวิเคราะห์ประสิทธิภาพ (Performance Analysis)

เอกสารนี้สรุปประเด็นด้านประสิทธิภาพที่อาจเกิดขึ้นได้ในโปรเจกต์ ragnarok-mvp-timer โดยเน้นที่ "ค่าใช้จ่ายด้านประสบการณ์ผู้ใช้ (User Experience)" เช่น ความเร็วในการโหลด และความลื่นไหลในการใช้งาน

---

## ปัญหาหลัก: ขนาดของแอปพลิเคชัน (Bundle Size) ที่ใหญ่เกินความจำเป็น

นี่คือประเด็นที่สำคัญที่สุดที่ส่งผลต่อประสิทธิภาพโดยตรง

### สาเหตุของปัญหา

แอปพลิเคชันมีการ `import` ข้อมูล MVP จากไฟล์ `.json` ทั้งหมดที่อยู่ในไดเรกทอรี `src/data/` เข้ามาในโค้ดโดยตรง ซึ่งกระบวนการ Build (เช่น `npm run build`) จะทำการรวมไฟล์ข้อมูลเหล่านี้ทั้งหมดเข้าไปเป็นส่วนหนึ่งของไฟล์ JavaScript สุดท้ายที่ผู้ใช้ต้องดาวน์โหลด

ไฟล์ที่เป็นสาเหตุได้แก่:
- `aRO.json`
- `bRO.json`
- `cRO.json`
- `fRO.json`
- `GGH.json`
- `idRO.json`
- `iRO.json`
- `iROC.json`
- `jRO.json`
- `kROM.json`
- `kROZ.json`
- `kROZS.json`
- `ruRO.json`
- `thROG.json`
- `twRO.json`

### ผลกระทบ

- **เว็บโหลดช้า:** ผู้ใช้ต้องดาวน์โหลดข้อมูลของ **ทุกเซิร์ฟเวอร์** ตั้งแต่ครั้งแรกที่เข้าเว็บ แม้ว่าเขาจะสนใจข้อมูลแค่เซิร์ฟเวอร์เดียวก็ตาม
- **ประสบการณ์ที่ไม่ดี:** โดยเฉพาะกับผู้ใช้ที่ความเร็วอินเทอร์เน็ตไม่สูง อาจต้องรอโหลดนานกว่าที่ควรจะเป็น

---

## ประเด็นรอง: การใช้ `localStorage`

### สาเหตุของปัญหา

การเขียนข้อมูลลง `localStorage` (ซึ่งน่าจะถูกจัดการผ่าน `usePersistedState`) เป็นการทำงานแบบ **Synchronous** หมายความว่าเบราว์เซอร์จะหยุดทำงานอื่นชั่วขณะเพื่อรอให้การเขียนข้อมูลเสร็จสิ้น

### ผลกระทบ

- **อาจเกิดอาการกระตุก (UI Lag):** หากมีการอัปเดตข้อมูล MVP จำนวนมากพร้อมๆ กัน (เช่น การตั้งเวลาตายของ MVP หลายสิบตัว) การที่แอปพยายามเขียนข้อมูลขนาดใหญ่ลง `localStorage` ในทุกๆ การเปลี่ยนแปลงอาจทำให้หน้าจอเกิดอาการกระตุกหรือค้างชั่วขณะได้

---

## สรุปและแนวทางแก้ไข

| ประเด็น | ระดับความสำคัญ | แนวทางแก้ไข |
| :--- | :--- | :--- |
| **Bundle Size ใหญ่** | **สูงมาก** | 1. **Dynamic Import**: เปลี่ยนไปโหลดไฟล์ `.json` เฉพาะของเซิร์ฟเวอร์ที่ผู้ใช้เลือกเท่านั้น<br>2. **API Server**: (สำหรับระยะยาว) ย้ายข้อมูลไปไว้บนเซิร์ฟเวอร์และให้แอปเรียกใช้ผ่าน API |
| **การใช้ `localStorage`** | **ปานกลาง** | 1. **Debouncing**: หน่วงเวลาการเขียนข้อมูลลง `localStorage` เพื่อลดความถี่ในการเขียน<br>2. **Optimize Data**: เลือกบันทึกเฉพาะข้อมูลที่จำเป็นจริงๆ (เช่น ID และเวลา) แทนการบันทึกทั้งออบเจกต์ |

การแก้ไขปัญหา Bundle Size จะช่วยเพิ่มประสิทธิภาพในการโหลดครั้งแรกได้อย่างมีนัยสำคัญ และเป็นสิ่งที่ควรพิจารณาเป็นอันดับแรกหากต้องการปรับปรุงประสบการณ์ผู้ใช้ครับ
